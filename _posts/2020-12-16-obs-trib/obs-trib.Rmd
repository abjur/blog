---
title: "Recuperação judicial, preservação formal e substancial da empresa"
description: |
  Evidências empíricas sobre a efetividade da recuperação judicial na manutenção da atividade econômica das empresas.
author:
  - name: Marcelo Barbosa Sacramone
    url: https://www.sacramone.com.br/sobre/
  - name: Julio Trecenti
    url: https://www.linkedin.com/in/jtrecenti/
  - name: Igor Pretel
    url: https://www.linkedin.com/in/pretel/
  - name: Marcelo Guedes Nunes
    url: https://www.linkedin.com/in/marcelo-guedes-nunes-849a4536/
  - name: Ivo Waisberg
    url: https://www.linkedin.com/in/ivo-waisberg/
categories:
  - Obervatorio
  - Recuperacoes
date: 12-16-2020
output:
  distill::distill_article:
    self_contained: false
# output: bookdown::word_document2
editor_options: 
  chunk_output_type: console
bibliography: bib.bib
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  dpi = 300
)
library(magrittr)
library(lubridate)
library(ggplot2)
library(obsFase2)
```

## Avaliação empírica da recuperação de empresas

O Brasil possui um ambiente macroeconômico instável, que sujeita as empresas ao enfrentamento de crises macroeconômicas periódicas. Fortes retrações do PIB, variações cambiais abruptas e crises de confiança no mercado consumidor atribuem ao mercado brasileiro um nível de risco elevado quando comparado a outros mercados mais estáveis.

A Lei de Recuperação de Empresas e Falência (LREF), Lei 11.101/05, é apresentada, tanto nos meios acadêmicos como para a opinião pública, como a principal, quando não única, resposta legal para o enfrentamento dessas situações. A recuperação judicial é um instituto cujo objetivo é auxiliar empresários a superar um momento conjuntural de crise econômico-financeira. Seu propósito seria assegurar uma solução comum entre devedores e credores para evitar que a atividade seja comprometida em função do prosseguimento das execuções individuais, ou mesmo da liquidação forçada falimentar, diante de problemas apenas circunstanciais ou momentâneos de mercado, e como forma de preservar a fonte geradora de riquezas, inovação, pagamento de tributos e empregos. 

A despeito de sua centralidade no debate sobre estratégias para a superação de crises e da abundância de dados econômicos e jurídicos sobre o tema, poucos estudos científicos (ou seja, empírico-quantitativos) foram realizados para mensurar os efeitos da LREF e a sua real capacidade de enfrentamento de crises. As discussões acadêmicas em torno de reformas legislativas seguem sem a realização de novos estudos e sem sequer considerar as análises já realizadas. A recente alteração empreendida pela lei n. 14.112/2020, que modificou importantes dispositivos da LREF, é um exemplo de alteração legislativa realizada às pressas, de forma intuitiva, que muito poderia ter se beneficiado de uma maior atenção aos estudos empíricos disponíveis.

Com o transcurso de mais de 15 anos da LREF e a sucessiva ocorrência de crises conjunturais nesse período, abriu-se uma valiosa oportunidade de avaliação do cumprimento das metas da LREF para se responder a uma pergunta tão simples quanto fundamental: afinal, a recuperação judicial preservou mesmo as empresas sob a condução do empresário devedor? A lei é capaz de efetivamente salvar empresas em quantidade suficiente para superar crises macroeconômicas? 

O propósito deste artigo é apresentar possíveis respostas para essas questões a partir de dados empíricos, levantados e analisados por meio de duas estratégias.

A primeira é a verificação da quantidade de falências requeridas e decretadas no Brasil e a quantidade de recuperações judiciais deferidas após a vigência da LREF. Como o objetivo da lei foi evitar que as execuções individuais pudessem comprometer a atividade empresarial a ser preservada, bem como que a recuperação judicial pudesse ser apresentada como uma alternativa à liquidação forçada falimentar, esperamos observar uma quantidade expressiva de recuperações judiciais deferidas em épocas de crise, bem como uma redução ou ao menos estabilização na quantidade de quebras observada no Poder Judiciário nesses mesmos períodos. Em termos quantitativos, o propósito é verificar (1) quão abrangente foi o uso da recuperação judicial pelos empresários, (2) se a LREF induziu o surgimento de uma “taxa natural” de falências no Brasil e (3) se essa taxa é ou não afetada em épocas de crise.

No entanto, tal análise isolada, ainda que a resposta para as três questões seja positiva, é insuficiente para avaliar o sucesso da LREF. A mera preservação formal de um empresário não é garantia da preservação de sua empresa, ou seja, de sua atividade econômica. Há o fundado receio de a recuperação judicial ser utilizada como meio de apropriação de recursos, seja pela liquidação de ativos, seja pelo consumo dos recursos escassos, fora da ordem estabelecida no processo falimentar. Ao invés de recuperar a atividade, o processo seria utilizado para o consumo de parcela relevante dos bens ou de liquidação do estabelecimento e o pagamento de credores em violação ao princípio da paridade de condições, como exigido na liquidação forçada falimentar.

Por essa razão, na segunda etapa do trabalho procuraremos mensurar o nível de atividade econômica das empresas remanescentes após a concessão do benefício da recuperação judicial. A distância entre os níveis de atividade posterior e anterior à recuperação serve como medida do grau de efetividade do benefício: quanto menor a distância, maior a efetividade; quanto maior a distância, mais próxima de uma falência a recuperação judicial estará.

Para medir o nível de atividade econômica remanescente será  feita uma comparação entre o nível de recolhimento de tributos estaduais da devedora antes e depois da recuperação judicial. O resultado esperado pelo legislador é uma curva de pagamento de tributos estaduais em formato de “U,” indicando um patamar normal de recolhimento antes da crise, seguido de uma queda no período da crise e, por fim, após a equalização do passivo, de uma retomada ao patamar normal após a finalização do processo de recuperação judicial.

Quanto mais o nível posterior de recolhimento se aproximar do anterior à recuperação, maiores serão os indicativos de que o instituto induziu a uma efetiva recuperação da atividade econômica. Por outro lado, quanto maior a distância do nível posterior em relação ao anterior, mais próxima estará a recuperação judicial de uma falência.

## Metodologia

```{r escopo}

col_abj <- viridis::viridis(2, 1, .2, .8)
blue_abj <- col_abj[1]
green_abj <- col_abj[2]

icms <- obsTrib::da_icms
icms$data_movimento <- icms$data_movimento - lubridate::years(70)

n_obs <- nrow(obsFase2::da_relatorio)
n_obs_trib <- scales::number(
  nrow(icms), 
  big.mark = ".", 
  decimal.mark = ","
)
escopo <- format(range(obsFase2::da_relatorio$data_dist), "%d de %B de %Y")
escopo <- paste(escopo, collapse = " e ")

da_plano <- obsFase2::da_relatorio %>% 
  dplyr::filter(stringr::str_detect(resultado_final, "Aprov")) %>% 
  dplyr::select(
    n_processo, 
    faturamento_total,
    divida,
    data_dist,
    data_decisao_deferimento,
    data_aprovacao,
    data_concessao,
    resultado_final,
    data_falencia,
    data_referencia,
    data_fim,
    desfecho_final,
    tempo_acompanhamento
  )


```

O estudo foi realizado a partir de três bases de dados. A primeira é a base do [observatório das recuperações judiciais](https://abjur.github.com/obsFase2)[^obs], que contém informações de `r n_obs` processos distribuídos entre `r escopo`. Para os fins do estudo, consideramos somente os casos em que o plano de recuperação foi aprovado, envolvendo `r nrow(da_plano)` casos. 

[^obs]: O Observatório da Insolvência é um trabalho contínuo da Associação Brasileira de Jurimetria - ABJ em parceria com a Pontifícia Universidade Católica de São Paulo - PUCSP, com o objetivo de acompanhar e estudar o comportamento dos processos judiciais de recuperação judicial e falência no Brasil. O observatório extrai e estrutura dados judiciais para viabilizar estudos empíricos sobre a crise empresarial, que servem de subsídio para a tomada de decisões estratégicas e a elaboração de políticas públicas baseadas em evidências.

A segunda base de dados é a de tributos, fornecida pela Procuradoria Geral do Estado de São Paulo (PGE-SP). A base contém `r n_obs_trib` dados de pagamentos de tributos de todas as empresas envolvidas nas recuperações judiciais analisadas no observatório, a partir de 2010. 

A terceira base de dados contém o volume mensal de pedidos de recuperação judicial e falências decretadas desde 1995 até 2020 em todo o Brasil.

O pagamento de tributos foi utilizado como uma *proxy* da atividade do empresário. A proxy possui vantagens e desvantagens. A principal vantagem é que o pagamento de tributos estaduais como o ICMS é uma consequência direta da circulação (em especial da venda) de produtos, o que contempla uma parte significativa das empresas consideradas no estudo. Com relação às desvantagens, destacamos duas principais. Primeiro, o tributo de maior interesse, o ICMS, pode não fazer parte das atividades de alguns empresários, como prestadores de serviço. Além disso, diferentes empresários podem ter estratégias diferentes de pagamento de tributos, de forma que a falta de pagamento em determinado período não significa, necessariamente, que não houve atividades no mesmo período. No estudo assumimos como suposição que o efeito de estratégias pontuais de alguns empresários para pagamento de tributos é desprezível.

A análise considerou somente os casos que tiveram o processamento da recuperação judicial deferido e plano de recuperação aprovado. Foram consideradas três etapas principais: até 5 anos antes do deferimento, entre o deferimento e a aprovação do plano, e até 5 anos após a aprovação do plano. Nos casos em que a informação é incompleta, ou seja, quando não existem dados de antes de 5 anos do deferimento e depois de 5 anos da aprovação, os casos foram considerados com as informações que estão disponíveis. Como uma parte dos processos ainda estava na etapa de cumprimento do plano no momento da realização da pesquisa, as análises separaram casos que tiveram o plano aprovado até meados de 2017, de modo a identificar todos os processos que passaram pelos 2 anos obrigatórios da etapa de cumprimento do plano.

Outro aspecto importante a ser controlado é o porte da empresa. Empresários de maior porte pagam mais tributos, o que poderia distorcer as análises. Por isso, foi necessário empregar uma variável de normalização para ajustar o recolhimento ao porte. Inicialmente, foram consideradas quatro possíveis variáveis de normalização: capital social, faturamento, média de recolhimento de tributos e endividamento. Três das quatro foram descartadas pelas seguintes razões.

O capital social, obtido a partir do cruzamento dos CNPJs com a base pública da Receita Federal do Brasil (RFB), foi descartado por ser um dado histórico não relacionado ao porte da empresa no momento da apresentação do pedido de recuperação judicial. 

A informação do faturamento do empresário, colhida dos balanços submetidos para processamento de recuperação judicial, foi descartada porque não estava disponível em todos os casos.

A média de tributos recolhida no período foi descartada pela possibilidade de dar uma ênfase muito elevada a empresários que recolhem poucos tributos estaduais.

Ao final, a variável de normalização escolhida foi o endividamento sujeito à recuperação judicial na data de apresentação do pedido de recuperação, obtido a partir da lista de credores ou quadro geral de credores homologado. Além de ser contemporâneo ao pedido de recuperação, o endividamento está correlacionado ao ativo da empresa e com o seu faturamento bruto anual, conforme demonstrado na segunda fase do Observatório da Insolvência.

Da combinação dessas análises, esperamos sugerir respostas para as questões levantadas no tópico anterior relacionadas ao que chamaremos de preservação formal e preservação substancial de empresas. A preservação formal consiste na não decretação da quebra do empresário, evitando-se um processo falimentar e promovendo a manutenção formal de um CNPJ ativo.

Já a preservação substancial consiste na preservação da atividade econômica efetiva sob a condução do empresário devedor, com geração de empregos e pagamento de tributos, em um nível próximo ao existente antes da crise. A distinção é de grande relevância porque o objetivo teleológico da lei para o instituto da recuperação judicial é a preservação da atividade econômica substancial sob a condução da devedora e não apenas a manutenção de uma existência meramente formal.

## Preservação formal da empresa: resultados da primeira análise

A Figura \@ref(fig:fal) mostra a série histórica de pedidos e de decretações de falência no Brasil de 1995 até dezembro de 2020. A linha pontilhada indica o momento do início da vigência da LREF. 

```{r fal, fig.cap="Volume mensal de falências requeridas e decretadas antes e depois do início da vigência da LREF.", fig.width=9, fig.height=7, layout="l-body-outset"}

media_pos_2010 <- falrec::falrec %>% 
  dplyr::filter(
    tipo == "fal", 
    evento == "req", 
    data >= "2010-01-01"
  ) %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

media_dec_pos_2010 <- falrec::falrec %>% 
  dplyr::filter(
    tipo == "fal", 
    evento == "dec", 
    data >= "2010-01-01"
  ) %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

fal_razao <- pct(media_dec_pos_2010/media_pos_2010)

media_fal_2010_2019 <- falrec::falrec %>% 
  dplyr::mutate(wrap = dplyr::case_when(
    tipo == "fal" & evento == "req" ~ "1. Falências Requeridas",
    tipo == "fal" & evento == "dec" ~ "2. Falências Decretadas"
  )) %>% 
  dplyr::filter(
    n > 0, 
    tipo == "fal", 
    tamanho == "total",
    data >= "1995-01-01"
  ) %>% 
  dplyr::filter(evento == "req") %>% 
  dplyr::filter(lubridate::year(data) >= 2010) %>% 
  dplyr::group_by(ano = lubridate::year(data), tipo) %>% 
  dplyr::summarise(qtd = sum(n), .groups = "drop") %>% 
  dplyr::filter(ano < 2020) %>% 
  dplyr::summarise(m = mean(qtd)) %>% 
  with(m)


falrec::falrec %>% 
  dplyr::mutate(wrap = dplyr::case_when(
    tipo == "fal" & evento == "req" ~ "1. Falências Requeridas",
    tipo == "fal" & evento == "dec" ~ "2. Falências Decretadas"
  )) %>% 
  dplyr::filter(
    n > 0, 
    tipo == "fal", 
    tamanho == "total",
    data >= "1995-01-01"
  ) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = data, y = n) +
  ggplot2::geom_line(colour = blue_abj, size = .8) +
  ggplot2::facet_wrap(~wrap, scales = "free_y", ncol = 1) +
  ggplot2::geom_vline(
    xintercept = as.Date("2005-01-01") + 120, 
    colour = "red",
    linetype = 2
  ) +
  ggplot2::scale_x_date(date_breaks = "2 year", date_labels = "%Y") +
  ggplot2::theme_bw(12) +
  ggplot2::scale_colour_viridis_d(begin = .2, end = .8) +
  ggplot2::labs(x = "Data", y = "Volume mensal", colour = "Tamanho") +
  ggplot2::theme(legend.position = "bottom")
```

Os dados apontam um impacto da LREF nas duas métricas, que descrevem trajetórias de queda a partir de 2005. 

As imagens são auto-explicativas. A quantidade de pedidos de falência cai abruptamente até atingir o patamar de `r media_pos_2010` pedidos por mês e estabilizar[^media]. A queda pode ser atribuída principalmente ao artigo art. 94 da LREF, que limitou o valor mínimo de um pedido de falência a quarenta salários mínimos. 

O segundo gráfico mostra que a quantidade de decretações de falência também caiu como resultado da LREF, mas descreve uma trajetória diferente. A quantidade de decretações de quebra também cai, mas descreve uma trajetória diferente. A queda é mais suave e se estende por 4 anos até atingir o patamar de `r media_dec_pos_2010` falências decretadas por mês e é uma decorrência da redução na quantidade de pedidos de falência protraída no tempo. Com menos pedidos há menos deferimentos. A quantidade de decretações corresponde a `r fal_razao` dos pedidos e obedece de forma aproximada ao equilíbrio definido por @priest1984selection.

[^media]: Médias calculadas com os dados a partir do ano de 2010, tanto para falências requeridas quanto decretadas.

As disfunções na falência geram reflexos nos pedidos de recuperação judicial, que descrevem uma trajetória distinta dos processos falimentares, como mostra a Figura \@ref(fig:rec).

```{r rec, fig.cap="Volume mensal de recuperações requeridas e deferidas depois do início da vigência da LREF.", fig.width=9, fig.height=7, layout="l-body-outset"}

media_recreq_pos_2010 <- falrec::falrec %>% 
  dplyr::filter(
    tipo == "rec", 
    evento == "req", 
    data >= "2010-01-01"
  ) %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

media_recdef_pos_2010 <- falrec::falrec %>% 
  dplyr::filter(
    tipo == "rec", 
    evento == "def", 
    data >= "2010-01-01"
  ) %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

rec_razao <- pct(media_recreq_pos_2010/media_recdef_pos_2010)

pib <- readr::read_lines("pib.csv")
p_pib <- tibble::tibble(
  trim = unlist(stringr::str_split(pib[2], ";"))[-1],
  val = unlist(stringr::str_split(pib[3], ";"))[-1]
) %>% 
  dplyr::mutate(
    trim = as.Date(lubridate::parse_date_time(trim, "q Y")),
    val = as.numeric(val)
  ) %>% 
  dplyr::filter(lubridate::year(trim) >= 2005) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = trim, y = val) +
  ggplot2::geom_line(colour = blue_abj, size = .8) +
  ggplot2::scale_x_date(
    date_breaks = "2 year", date_labels = "%Y",
    limits = as.Date(c("2005-01-01", "2021-01-01"))
  ) +
  ggplot2::theme_bw(12) +
  ggplot2::labs(x = "Trimestre", y = "Variação do PIB (%)")
  
p_rec <- falrec::falrec %>% 
  dplyr::mutate(wrap = dplyr::case_when(
    tipo == "rec" & evento == "req" ~ "1. Recuperações Requeridas",
    tipo == "rec" & evento == "def" ~ "2. Recuperações Deferidas"
  )) %>% 
  dplyr::filter(
    n > 0, 
    tipo == "rec", 
    evento == "req",
    tamanho == "total",
    data >= "1995-01-01"
  ) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = data, y = n) +
  ggplot2::geom_line(colour = blue_abj, size = .8) +
  # ggplot2::facet_wrap(~wrap, scales = "free_y", ncol = 1) +
  ggplot2::geom_vline(
    xintercept = as.Date("2005-01-01") + 120, 
    colour = "red",
    linetype = 2
  ) +
  ggplot2::scale_x_date(
    date_breaks = "2 year", date_labels = "%Y",
    limits = as.Date(c("2005-01-01", "2021-01-01"))
  ) +
  ggplot2::theme_bw(12) +
  ggplot2::scale_colour_viridis_d(begin = .2, end = .8) +
  ggplot2::labs(x = "Mês", y = "Recuperações requeridas") +
  ggplot2::theme(legend.position = "bottom")


p_rec_var <- falrec::falrec %>% 
  dplyr::mutate(wrap = dplyr::case_when(
    tipo == "rec" & evento == "req" ~ "1. Recuperações Requeridas",
    tipo == "rec" & evento == "def" ~ "2. Recuperações Deferidas"
  )) %>% 
  dplyr::filter(
    n > 0, 
    tipo == "rec", 
    evento == "req",
    tamanho == "total",
    data >= "1995-01-01"
  ) %>% 
  dplyr::mutate(trim = lubridate::floor_date(data, "quarter")) %>% 
  dplyr::group_by(trim) %>% 
  dplyr::summarise(n = sum(n)) %>% 
  dplyr::mutate(lag = dplyr::lag(n), val = (n / lag - 1) * 100) %>% 
  dplyr::filter(!is.na(val), abs(val) < 200) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = trim, y = val) +
  ggplot2::geom_line(colour = blue_abj, size = .8) +
  ggplot2::scale_x_date(
    date_breaks = "2 year", date_labels = "%Y",
    limits = as.Date(c("2005-01-01", "2021-01-01"))
  ) +
  ggplot2::theme_bw(12) +
  ggplot2::labs(x = "Trimestre", 
                y = "Variação recuperações (%)")

patchwork::wrap_plots(p_rec, p_rec_var, p_pib, ncol = 1)
```

Entre 2005, ano de sua promulgação, e 2008 a recuperação passa por um período de latência, iniciando um acentuado crescimento a partir de 2009, por conta dos reflexos da crise do *subprime* no Brasil. O crescimento prossegue de forma acentuada até início de 2016, porém descreve uma trajetória cuja correlação com a variação trimestral do PIB não é forte. As recuperações judiciais sofrem aumentos posteriores a períodos de retração do PIB e há uma tendência de crescimento entre 2008 e 2020. Com isso, apesar de verificarmos a estabilização dos pedidos de falência mesmo em períodos de crise, essa estabilização não parece associada ao uso da recuperação judicial como remédio de prevenção em momentos de crise.

A análise dos dados nos leva a algumas considerações.

Primeiro, a vigência da LREF está associada a uma acentuada redução na quantidade de pedidos e de decretações de falência. O Brasil apresenta hoje um patamar de pedidos de falência (`r media_pos_2010` por mês) e decretações de quebra (`r media_dec_pos_2010` por mês). Os patamares de pedidos e de decretações não sofreram aumentos significativos nos períodos de crise macroeconômica, que se seguiram à LREF até 2019. Entre 2005 e 2020, o Brasil passou por duas crises com fortes retrações no PIB em curtos períodos de tempo: 2007-2008 (crise de subprime) e 2014-2015 (crise do impeachment da Dilma).

A queda em si na quantidade de falências pode ser encarada, em uma primeira análise, como algo positivo. Essa conclusão, no entanto, merece aprofundamento.

A falência tem a função social de retirar do mercado os empresários menos competitivos, com a liquidação de seus ativos no melhor valor para não apenas permitir o pagamento dos credores dentro de certos critérios, mas também promover a melhor alocação dos diversos fatores de produção para um empresário arrematante mais eficiente, o que asseguraria melhor condição para promover o desenvolvimento econômico nacional. 

Assim, em todo mercado saudável, espera-se observar uma certa quantidade de falências resultantes da própria competição que nele se estabelece. Não ter falências ou ter muito poucas falências é algo preocupante. Mas o que seriam poucas falências? Uma comparação da quantidade de falências no Brasil com os Estados Unidos dispara alguns alertas.

```{r contas-mgn}
razao_pib <- round(2143 / 184)
razao_empresas <- round(31/4.5)
razao_falencias <- round(22780 / 1417)
```

Os EUA, com PIB de US\$ 21,4 trilhões e 31 milhões de empresas[^biz] registrou 22.780 pedidos de falência em 2019[^statista]. O Brasil, com PIB de US$ 1,8 trilhão[^ibge] e 4,5 milhões de empresas ativas[^mapa], apresentou 1.417 pedidos de falência no mesmo ano. Considerando o fato do mercado americano ser `r razao_pib` vezes maior, se basear em uma população de empresas `r razao_empresas` vezes maior e que a quantidade de falências é diretamente proporcional a alguma dessas quantidades, é esperada uma quantidade de falências nos EUA entre `r razao_empresas` e `r razao_pib` a do Brasil. No entanto, a quantidade de falências é `r razao_falencias` vezes a do Brasil, pelo menos um terço acima do esperado. Assumindo que os EUA não apresentam uma quantidade exagerada de falências, a comparação indica que o Brasil provavelmente tem um baixo índice de liquidação formal de empresas.

[^biz]: Vide https://www.bizjournals.com/albany/news/2019/04/11/number-of-businesses-in-the-united-states.html e https://cdn.advocacy.sba.gov/wp-content/uploads/2019/04/23142610/2019-Small-Business-Profiles-States-Territories.pdf

[^statista]: Vide https://www.statista.com/statistics/817918/number-of-business-bankruptcies-in-the-united-states/

[^ibge]: Ao câmbio de dezembro de 2019, vide https://www.ibge.gov.br/explica/pib.php

[^mapa]: Excluídos empresários individuais, cooperativas e outros tipos menores, https://www.gov.br/governodigital/pt-br/mapa-de-empresas/painel-mapa-de-empresas


A reduzida quantidade de pedidos de falência no país é um possível resultado da disfunção do processo falimentar e da sua incapacidade em satisfazer os créditos. O processo demora demais, impõe custos e apresenta um retorno pequeno. De acordo com o tópico resolução da insolvência do Relatório Doing Business de 2020[^doingbusiness], realizado pelo Banco Mundial, o Brasil (RJ e SP) apresenta uma taxa de recuperação de crédito de 18,2 centavos para cada dólar americano. Nos países da OCDE a taxa está em 70,2 centavos e na América Latina e Caribe a taxa é de 31,2 centavos por dólar. A duração do processo é estimada em 4 anos, período que aparenta estar subestimado. Daí a recalcitrância dos credores em propor esse tipo de ação e buscar outras formas de solução, incluindo se sujeitar a liquidações irregulares.

[^doingbusiness]: Vide https://portugues.doingbusiness.org/pt/data/exploretopics/resolving-insolvency

Os dados de recuperação judicial também são reveladores e dois pontos devem ser discutidos: de um lado a quantidade de recuperações e de outro o padrão de crescimento. 

No que se refere à quantidade de recuperações, a série histórica mostra um crescimento da utilização da recuperação judicial no mercado desde 2008 de forma consistente, com indícios de correlação com os períodos de contração do PIB. A ausência de uma correlação forte indica a possibilidade de que empresários que se encontram em crise não por motivos conjunturais, mas por uma inviabilidade estrutural (e que, portanto, são essencialmente irrecuperáveis), possam estar utilizando a recuperação judicial para consumir os recursos escassos ou viabilizar uma liquidação de parte substancial de seus ativos fora das regras falimentares, em benefício da devedora e de uma parcela dos credores.

Os impactos da queda no PIB tendem a ser explicitados em ações de insolvência iniciadas após as retrações. Ao mesmo tempo em que os dados não indicam aumentos significativos na quantidade de falências requeridas ou decretadas nos respectivos períodos, observa-se um aumento na quantidade de recuperações judiciais requeridas nos intervalos de tempo associados às crises.

A análise sugere a existência de uma redução na quantidade de falências requeridas e decretadas após a vigência da LREF, com a estabilização em novos patamares mais baixos, bem como indica a ausência de impacto das crises nessas duas quantidades, como esperado pelo legislador. 

Do ponto de vista formal, a existência das empresas foi preservada pela LREF. A questão agora diz respeito à preservação substancial das atividades, ou seja, se as empresas que deixaram de ter a sua falência formalmente decretada foram capazes de preservar suas atividades em níveis próximos aqueles existentes antes da recuperação judicial.

## Preservação substancial da empresa: resultados da segunda análise

Para a análise utilizou-se o pagamento de ICMS como referência para o nível de atividade da devedora antes e depois da recuperação judicial. Foi criada uma variável separando os três períodos do processo: antes da distribuição, entre a distribuição e aprovação do plano e depois da aprovação do plano. Os valores em cada período foram somados e divididos pelo tempo total do período, em anos. Os valores pagos foram então divididos pela variável de normalização. Finalmente, para cada intervalo, foi calculado o valor médio das taxas normalizadas, colocadas no intervalo `[0,1]`. Consideramos apenas processos que possuem dados de recolhimento nos três períodos.

```{r base-obs}
empresas_processos <- obsFase2::out_ramo_atuacao %>% 
  dplyr::select(n_processo, cnpj) %>% 
  dplyr::distinct(cnpj, .keep_all = TRUE)

aux_valor <- icms %>% 
  # ajustes novos e inesperados
  dplyr::select(-data_falencia) %>% 
  # depara
  dplyr::inner_join(empresas_processos, "cnpj") %>% 
  # coloca processos
  dplyr::inner_join(da_plano, "n_processo") %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::mutate(
    capital = sum(capital[!duplicated(cnpj) & capital > 0]),
    periodo = as.numeric(diff(range(data_movimento))) / 365.25,
    valor_processo = sum(valor_total) / periodo
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(capital = dplyr::case_when(
    capital == 0 ~ NA_real_,
    TRUE ~ capital
  )) %>% 
  tidyr::replace_na(
    list(desfecho_final = "Fase de acompanhamento (até 2 anos)")
  ) %>% 
  dplyr::mutate(desfecho_final = dplyr::case_when(
    desfecho_final == "Ainda em curso" ~ 
      "Fase de acompanhamento (> 2 anos)",
    TRUE ~ desfecho_final
  )) %>% 
  dplyr::mutate(dt_ref = dplyr::coalesce(data_concessao, data_aprovacao))

aux_periodos <- aux_valor %>% 
  dplyr::mutate(
    momento = dplyr::case_when(
      data_movimento < data_dist ~ "1. Antes da distribuição",
      data_movimento < dt_ref ~ "2. Entre distribuição e aprovação do plano",
      TRUE ~ "3. Depois da aprovação do plano"
    ),
    data_limite = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      data_movimento < data_dist ~ min(data_movimento),
      data_movimento < dt_ref ~ data_movimento,
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      TRUE ~ max(data_movimento)
    ),
    tempo = dplyr::case_when(
      data_movimento < data_dist ~ as.numeric(data_dist - data_movimento),
      data_movimento < dt_ref ~ as.numeric(dt_ref - data_dist),
      TRUE ~ as.numeric(data_movimento - dt_ref)
    )
  ) %>% 
  dplyr::arrange(dplyr::desc(tempo)) %>% 
  # tirar tempos muito grandes
  # dplyr::filter(tempo <= 5 * 365.25) %>% 
  # tirar casos que faliram
  dplyr::filter(desfecho_final != "Falência", !is.na(tempo)) %>% 
  dplyr::group_by(momento, n_processo) %>% 
  dplyr::summarise(
    tmin = min(icms$data_movimento, na.rm = TRUE),
    tmax = max(icms$data_movimento, na.rm = TRUE),
    tempo_total = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      dplyr::first(momento) == "1. Antes da distribuição" ~ 
        max(0, dplyr::first(data_dist) - tmin),
      dplyr::first(momento) == "2. Entre distribuição e aprovação do plano" ~ 
        max(tempo),
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      dplyr::first(momento) == "3. Depois da aprovação do plano" ~ 
        max(0, tmax - dplyr::first(dt_ref))
    ),
    valor_total = sum(valor_total) / tempo_total * 365.25,
    capital = dplyr::first(capital),
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo
  )


```

A Figura \@ref(fig:taxas) mostra as taxas de pagamento de ICMS nos três momentos, considerando a dívida para controlar pelo porte da empresa. Os pagamentos sofrem uma abrupta e esperada queda na segunda fase, mas ficam estáveis após a aprovação do plano. Isso poderia indicar uma eventual mudança de atividade das empresas após o processamento da recuperação judicial.

```{r taxas, message=FALSE, fig.height=4, fig.width=7, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS em cada momento dos processos, considerando a dívida para controlar pelo porte da empresa. Casos que acabaram em falência foram desconsiderados da análise"}
aux_plot_arrumado <- aux_periodos %>% 
  # somente processos que passaram pelas 3 etapas
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(!is.na(valor_divida)) %>% 
  dplyr::group_by(momento) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor_mediana = median(valor_total, na.rm = TRUE),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(
    -c(momento, n, valor, valor_mediana), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::mutate(momento = stringr::str_wrap(momento, 15))


aux_plot_arrumado %>% 
  ggplot(aes(momento, divida)) +
  geom_col(fill = blue_abj, width = .8) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  geom_text(
    aes(label = paste("n =", n)), 
    vjust = 1.1, size = 5, 
    colour = "white",
    data = dplyr::filter(
      aux_plot_arrumado,
      momento == "1. Antes da\ndistribuição"
    )
  ) +
  theme_minimal(12) +
  labs(x = "Fase do processo", y = "Taxa")
```

A Figura \@ref(fig:taxas-dist) mostra a distribuição das taxas de pagamento de ICMS. Apesar das médias indicadas na figura anterior, é possível observar que os recolhimentos mesmo normalizados, são concentrados em torno de zero.

```{r taxas-dist, message=FALSE, fig.height=5, fig.width=7, layout="l-body-outset", fig.cap="Distribuição das taxas de pagamento de ICMS em cada momento dos processos, considerando a dívida para controlar pelo porte da empresa. Casos que acabaram em falência foram desconsiderados da análise. Para fins de visualização, as 5% maiores taxas foram omitidas do gráfico."}

aux_periodos %>% 
  dplyr::filter(!is.na(valor_divida)) %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(
    valor_divida = valor_divida / max(valor_divida),
    q95 = quantile(valor_divida, .95)
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(valor_divida < q95) %>%
  dplyr::mutate(momento = stringr::str_wrap(momento, 20)) %>% 
  ggplot(aes(y = momento, x = valor_divida)) +
  ggridges::geom_density_ridges(stat = "binline", fill = green_abj, alpha = .5) +
  theme_bw(12) +
  labs(x = "Taxa", y = "Fase do processo")
```


Uma segunda investigação de interesse é verificar os pagamentos de acordo com o status do processo. Os processos foram divididos em falência durante o cumprimento, encerramento da recuperação, fase de cumprimento (até 2 anos) e fase de cumprimento (passados 2 anos).

```{r aux-plot-desfecho}

aux_plot_desfecho <- aux_valor %>% 
  dplyr::mutate(
    momento = dplyr::case_when(
      data_movimento < data_dist ~ "1. Antes da distribuição",
      data_movimento < dt_ref ~ "2. Entre distribuição e aprovação do plano",
      TRUE ~ "3. Depois da aprovação do plano"
    ),
    tempo = dplyr::case_when(
      data_movimento < data_dist ~ 
        as.numeric(data_dist - data_movimento),
      data_movimento < dt_ref ~ 
        as.numeric(dt_ref - data_dist),
      TRUE ~ 
        as.numeric(data_movimento - dt_ref)
    )
  ) %>% 
  dplyr::arrange(dplyr::desc(tempo)) %>% 
  # tirar tempos muito grandes
  # dplyr::filter(tempo <= 5 * 365.25) %>% 
  dplyr::group_by(momento, n_processo, desfecho_final) %>% 
  dplyr::summarise(
    tmin = min(icms$data_movimento, na.rm = TRUE),
    tmax = max(icms$data_movimento, na.rm = TRUE),
    tempo_total = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      dplyr::first(momento) == "1. Antes da distribuição" ~ 
        max(0, dplyr::first(data_dist) - tmin),
      dplyr::first(momento) == "2. Entre distribuição e aprovação do plano" ~ 
        max(tempo),
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      dplyr::first(momento) == "3. Depois da aprovação do plano" ~ 
        max(0, tmax - dplyr::first(dt_ref))
    ),
    valor_total = sum(valor_total) / tempo_total * 365.25,
    capital = dplyr::first(capital),
    valor_processo = dplyr::first(valor_processo),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  # somente processos que passaram pelas 3 etapas
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_processo = valor_total / valor_processo,
    valor_divida = valor_total / divida
  ) %>% 
  dplyr::filter(!is.na(valor_divida))

```

A Figura \@ref(fig:taxa-desfecho-divida) mostra as taxas de pagamento por status do processo, considerando a dívida como variável de normalização. É possível observar que tanto os casos envolvendo fase de acompanhamento inacabada quanto os que estão em fase de acompanhamento há muito tempo tiveram decrescimento nos pagamentos após a distribuição. Nos casos com encerramento sem falência, os pagamentos atingiram valores mais altos que o inicial.

```{r taxa-desfecho-divida, message=FALSE, layout="l-body-outset", fig.cap="Taxa de pagamento de ICMS nas fases dos processos, separando pelo status dos processos, utilizando a dívida.", fig.width=7, fig.height=5}

aux_plot_arrumado <- aux_plot_desfecho %>% 
  dplyr::group_by(momento, desfecho_final) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::group_by(desfecho_final) %>%
  dplyr::mutate(dplyr::across(
    c(capital, total, divida), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(momento = stringr::str_wrap(momento, 15))

aux_plot_arrumado %>% 
  ggplot(aes(momento, divida)) +
  geom_col(fill = blue_abj, width = .8) +
  geom_smooth(se = FALSE, colour = green_abj) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  geom_text(
    aes(label = paste("n =", n)), 
    vjust = 1.1, size = 4,
    colour = "white",
    data = dplyr::filter(
      aux_plot_arrumado, momento == "1. Antes da\ndistribuição"
    )
  ) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Fase do processo", y = "Taxa")
```

```{r densidade-desfecho-divida, eval=FALSE, message=FALSE, layout="l-body-outset", fig.cap="Boxplot das taxas de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos, utilizando a dívida. Para fins de visualização, as 5% maiores taxas foram omitidas do gráfico, para cada status.", fig.height=6, fig.width=8}

aux_plot_desfecho %>% 
  dplyr::filter(!is.na(valor_divida)) %>% 
  dplyr::group_by(desfecho_final) %>% 
  dplyr::mutate(
    valor_divida = valor_divida / max(valor_divida),
    q95 = quantile(valor_divida, .95)
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(valor_divida < q95) %>%
  dplyr::mutate(momento = stringr::str_wrap(momento, 20)) %>% 
  ggplot(aes(y = momento, x = valor_divida)) +
  ggridges::geom_density_ridges(stat = "binline", fill = green_abj, alpha = .5) +
  facet_wrap(~desfecho_final, scales = "free_x") +
  theme_bw(12) +
  labs(x = "Taxa", y = "Fase do processo")
```

A Figura \@ref(fig:individuais) mostra os perfis individuais de recolhimento. O gráfico abre os dados agregados da figura anterior, mostrando, por exemplo, que houve um caso específico que influenciou fortemente nas médias observadas na subpopulação de casos com encerramento sem falência.

```{r individuais, fig.cap='Perfis individuais da taxa de recolhimento de ICMS pela dívida, em cada momento do processo. Cada linha é um processo.', eval=TRUE, message=FALSE, layout="l-body-outset", fig.width=8, fig.height=5}
# esse gráfico é too much para seres humanos
aux_plot_desfecho %>% 
  dplyr::filter(!is.na(valor_divida)) %>% 
  dplyr::group_by(desfecho_final) %>% 
  dplyr::mutate(
    valor_divida = valor_divida / max(valor_divida),
    q95 = quantile(valor_divida, .95)
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  # dplyr::filter(valor_divida < q95) %>%
  dplyr::mutate(momento = stringr::str_wrap(momento, 20)) %>% 
  ggplot(aes(x = momento, y = valor_divida, group = n_processo)) +
  geom_line() +
  facet_wrap(~desfecho_final) +
  scale_y_log10(labels = scales::number) +
  theme_minimal(12) +
  labs(
    x = "Fase do processo",
    y = "Taxa"
  )
```

### Base adicional: arrecadação

Além das bases de recolhimentos de ICMS, também recebemos uma base com dados de arrecadação. A base, no entanto, é agregada por ano e por CNPJ, o que limita parcialmente as análises realizadas. Por exemplo, se o processo de uma empresa foi distribuído em março de 2013 e o ano de arrecadação é 2013, não é possível dividir a arrecadação de forma precisa antes e depois de março. Para fins deste estudo, arbitramos que as arrecadações foram realizadas no mês de junho do ano observado. 

Outra limitação da base adicional é a diferença na fonte de dados. A fonte dos dados é diferente da base de recolhimento e foi recebida em diferentes momentos. Isso implica que a quantidade de observações pode mudar nas análises abaixo, em comparação com as análises realizadas até aqui.

```{r arrecadacao-process}

icms_pgto <- obsTrib::icms_pgto %>% 
  dplyr::distinct(cnpj, ano, .keep_all = TRUE) %>%
  dplyr::mutate(data_movimento = lubridate::ymd(paste0(ano, "-06-01"))) %>% 
  dplyr::select(cnpj, data_movimento, valor_total = valor_arrec)

aux_valor_arrecadacao <- icms_pgto %>% 
  # depara
  dplyr::inner_join(empresas_processos, "cnpj") %>% 
  # coloca processos
  dplyr::inner_join(da_plano, "n_processo") %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::mutate(
    periodo = as.numeric(diff(range(data_movimento))) / 365.25,
    valor_processo = sum(valor_total) / periodo
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::replace_na(
    list(desfecho_final = "Fase de acompanhamento (até 2 anos)")
  ) %>% 
  dplyr::mutate(desfecho_final = dplyr::case_when(
    desfecho_final == "Ainda em curso" ~ "Fase de acompanhamento (> 2 anos)",
    TRUE ~ desfecho_final
  )) %>% 
  dplyr::mutate(dt_ref = dplyr::coalesce(data_concessao, data_aprovacao))

aux_periodos_arrecadacao <- aux_valor_arrecadacao %>% 
  dplyr::mutate(
    momento = dplyr::case_when(
      data_movimento < data_dist ~ "1. Antes da distribuição",
      data_movimento < dt_ref ~ "2. Entre distribuição e aprovação do plano",
      TRUE ~ "3. Depois da aprovação do plano"
    ),
    data_limite = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      data_movimento < data_dist ~ min(data_movimento),
      data_movimento < dt_ref ~ data_movimento,
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      TRUE ~ max(data_movimento)
    ),
    tempo = dplyr::case_when(
      data_movimento < data_dist ~ as.numeric(data_dist - data_movimento),
      data_movimento < dt_ref ~ as.numeric(dt_ref - data_dist),
      TRUE ~ as.numeric(data_movimento - dt_ref)
    )
  ) %>% 
  dplyr::arrange(dplyr::desc(tempo)) %>% 
  # tirar tempos muito grandes
  # dplyr::filter(tempo <= 5 * 365.25) %>% 
  # tirar casos que faliram
  dplyr::filter(desfecho_final != "Falência", !is.na(tempo)) %>% 
  dplyr::group_by(momento, n_processo) %>% 
  dplyr::summarise(
    tmin = min(icms_pgto$data_movimento, na.rm = TRUE),
    tmax = max(icms_pgto$data_movimento, na.rm = TRUE),
    tempo_total = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      dplyr::first(momento) == "1. Antes da distribuição" ~ 
        max(0, dplyr::first(data_dist) - tmin),
      dplyr::first(momento) == "2. Entre distribuição e aprovação do plano" ~ 
        max(tempo),
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      dplyr::first(momento) == "3. Depois da aprovação do plano" ~ 
        max(0, tmax - dplyr::first(dt_ref))
    ),
    valor_total = sum(valor_total) / tempo_total * 365.25,
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>% 
  dplyr::mutate(
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo
  )


```

A Figura \@ref(fig:taxas-arrecadacao) mostra as médias das taxas de arrecadação normalizadas pela dívida, em cada período dos processos. É possível observar que, após a aprovação do plano, em média, as empresas passaram a arrecadar mais do que antes ou durante o processamento da recuperação judicial.

```{r taxas-arrecadacao, fig.cap="Médias das taxas de arrecadação normalizadas pela dívida, separadas por fase do processo.", message=FALSE, layout="l-body-outset", fig.width=7, fig.height=5}

aux_plot_arrumado_arrecadacao <- aux_periodos_arrecadacao %>% 
  # somente processos que passaram pelas 3 etapas
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(!is.na(valor_divida)) %>% 
  dplyr::group_by(momento) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor_mediana = median(valor_total, na.rm = TRUE),
    valor = mean(valor_total, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(
    -c(momento, n, valor, valor_mediana), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::mutate(momento = stringr::str_wrap(momento, 15))

aux_plot_arrumado_arrecadacao %>% 
  ggplot(aes(momento, divida)) +
  geom_col(fill = blue_abj, width = .8) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  geom_text(
    aes(label = paste("n =", n)), 
    vjust = 1.1, size = 5, 
    colour = "white",
    data = dplyr::filter(
      aux_plot_arrumado_arrecadacao,
      momento == "1. Antes da\ndistribuição"
    )
  ) +
  theme_minimal(12) +
  labs(x = "Fase do processo", y = "Taxa")
```

A Figura \@ref(fig:arrecadacao-facets) mostra as mesmas taxas, mas separando pelo momento que o processo se encontra. É possível notar que, com exceção do encerramento com falência, as arrecadações aumentam após o período entre distribuição e aprovação do plano. Nos casos com fases de acompanhamento maiores de dois anos e de encerramento sem falência, a média de arrecadação é menor do que a média antes da distribuição dos processos.

```{r arrecadacao-facets, fig.cap="Médias das taxas de arrecadação normalizadas pela dívida, separadas por fase do processo e momento atual do processo.", message=FALSE, layout="l-body-outset", fig.width=7, fig.height=5}
aux_plot_desfecho_arrecadacao <- aux_valor_arrecadacao %>% 
  dplyr::mutate(
    momento = dplyr::case_when(
      data_movimento < data_dist ~ "1. Antes da distribuição",
      data_movimento < dt_ref ~ "2. Entre distribuição e aprovação do plano",
      TRUE ~ "3. Depois da aprovação do plano"
    ),
    tempo = dplyr::case_when(
      data_movimento < data_dist ~ 
        as.numeric(data_dist - data_movimento),
      data_movimento < dt_ref ~ 
        as.numeric(dt_ref - data_dist),
      TRUE ~ 
        as.numeric(data_movimento - dt_ref)
    )
  ) %>% 
  dplyr::arrange(dplyr::desc(tempo)) %>% 
  # tirar tempos muito grandes
  # dplyr::filter(tempo <= 5 * 365.25) %>% 
  dplyr::group_by(momento, n_processo, desfecho_final) %>% 
  dplyr::summarise(
    tmin = min(icms_pgto$data_movimento, na.rm = TRUE),
    tmax = max(icms_pgto$data_movimento, na.rm = TRUE),
    tempo_total = dplyr::case_when(
      # se estou no primeiro momento, devo considerar o passado todo da empresa
      # limitado ao ano de 2010 que é o limite da base
      dplyr::first(momento) == "1. Antes da distribuição" ~ 
        max(0, dplyr::first(data_dist) - tmin),
      dplyr::first(momento) == "2. Entre distribuição e aprovação do plano" ~ 
        max(tempo),
      # se estou no ultimo momento, devo considerar o periodo de acompanhamento
      # completo, limitado a 2020 que é o limite da base
      dplyr::first(momento) == "3. Depois da aprovação do plano" ~ 
        max(0, tmax - dplyr::first(dt_ref))
    ),
    valor_total = sum(valor_total) / tempo_total * 365.25,
    valor_processo = dplyr::first(valor_processo),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  # somente processos que passaram pelas 3 etapas
  dplyr::filter(valor_total > 0) %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(dplyr::n() == 3) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(
    valor_processo = valor_total / valor_processo,
    valor_divida = valor_total / divida
  ) %>% 
  dplyr::filter(!is.na(valor_divida))

aux_plot_arrumado_arrecadacao <- aux_plot_desfecho_arrecadacao %>% 
  dplyr::group_by(momento, desfecho_final) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    valor = mean(valor_total, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::group_by(desfecho_final) %>%
  dplyr::mutate(dplyr::across(
    c(total, divida), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(momento = stringr::str_wrap(momento, 15))

aux_plot_arrumado_arrecadacao %>% 
  ggplot(aes(momento, divida)) +
  geom_col(fill = blue_abj, width = .8) +
  geom_smooth(se = FALSE, colour = green_abj) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  geom_text(
    aes(label = paste("n =", n)), 
    vjust = 1.1, size = 4,
    colour = "white",
    data = dplyr::filter(
      aux_plot_arrumado_arrecadacao, momento == "1. Antes da\ndistribuição"
    )
  ) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Fase do processo", y = "Taxa")
```


## Considerações finais

O objetivo do presente estudo foi identificar evidências empíricas da recuperação da atividade empresarial, a partir de dados do Observatório da Insolvência e de pagamento de ICMS pelas empresas. A hipótese de pesquisa era que as empresas apresentariam uma dinâmica de pagamento no formato de "U", deixando de pagar os tributos durante o processamento da recuperação e o retorno dos pagamentos após a aprovação do plano.

Pela metodologia utilizada e dados observados, é possível afirmar que existem evidências de que apenas parte dos empresários, equivalente a 18,2% dos empresários que tiveram planos aprovados até junho de 2016, de fato apresentam o referido comportamento. Foi possível identificar que esses empresários que tiveram a recuperação judicial encerrada retomaram o pagamento dos tributos em patamares similares aos observados nos anos anteriores, ao menos. 

A grande maioria, entretanto, desconfirma a hipótese.

Dos empresários que faliram, equivalente a 24,7% dos empresários que tiveram planos aprovados até junho de 2016, evidenciou-se que os empresários, embora tenham recolhido tributos durante a fase de negociação do plano de recuperação judicial, deixaram de pagar os tributos ao longo dos anos de cumprimento do plano.

Para o restante dos empresários em recuperação judicial, equivalentes a 57,1% do total, empresários que já tiveram o plano de recuperação judicial aprovados e possuem fase de acompanhamento em curso, houve queda significativa do recolhimento dos tributos. Houve queda durante a negociação do plano de recuperação judicial e os pagamentos anteriores à distribuição da recuperação judicial não foram restabelecidos por ocasião da aprovação do plano de recuperação judicial.

Pelo observado, nesses termos, ao considerar a dívida como fator para controlar o porte da empresa, existe uma redução da atividade empresarial após a data de referência, embora os resultados sejam diferentes de acordo com o status do processo. 


---

<!-- ## Gráficos descartados durante a análise -->

<!-- Os resultados podem ser observados na Tabela \@ref(tab:aux-plot). É possível observar que alguns intervalos de tempo ficaram com poucas observações, o que poderia distorcer os resultados. Por esse motivo, consideramos apenas intervalos com mais de 30 observações. -->

```{r aux-plot, include=FALSE}

aux_plot <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_dist)/365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>%
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo,
  ) %>% 
  dplyr::group_by(tempo) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor_mediana = median(valor_total, na.rm = TRUE),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(
    -c(tempo, n, valor, valor_mediana), 
    ~./max(., na.rm = TRUE)
  ))


aux_plot %>% 
  dplyr::select(-valor_mediana) %>% 
  purrr::set_names(c("Intervalo", 
                     "N", 
                     "Valor",
                     "Taxa (capital)",
                     "Taxa (valor pago)", 
                     "Taxa (faturamento)",
                     "Taxa (dívida)")) %>% 
  knitr::kable(
    caption = "Valores representando a dinâmica de pagamento de tributos, considerando as três estratégias para controlar pelo porte da empresa.", 
    digits = 2
  )
```


<!-- A Figura \@ref(fig:valor-desfecho) mostra os valores médios de pagamento por status do processo, sem normalização.  -->


```{r valor-desfecho, message=FALSE, layout="l-body-outset", fig.cap="Taxa de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos, utilizando a dívida.", eval=FALSE, include=FALSE}
aux_plot_desfecho %>%
  dplyr::mutate(momento = stringr::str_wrap(momento, 13)) %>% 
  ggplot(aes(momento, valor)) +
  geom_col(fill = blue_abj, width = .8) +
  geom_smooth(se = FALSE, colour = green_abj) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_text(aes(label = paste("n =", n)), vjust = 1.1, size = 3,
            colour = "white") +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Média do recolhimento anual")

```


<!-- A Figura \@ref(fig:valores) mostra o valor anual médio de recolhimento antes e depois da distribuição dos processos, sem normalização. É possível observar que os pagamentos sofrem uma queda próximos à distribuição, que retornam a partir dos seis anos após a distribuição. -->

```{r valores, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor médio de pagamento de ICMS antes e depois da distribuição dos processos.", include=FALSE}
aux_plot %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```


<!-- A Figura \@ref(fig:valores-mediana) mostra a mesma informação do gráfico anterior, mas utilizando a mediana como base. Com a mediana, observamos uma variabilidade maior nas barras, especialmente nas barras em que temos poucos dados. Por esse motivo, nesse caso a média pode ser mais apropriada. -->

```{r valores-mediana, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor mediano de pagamento de ICMS antes e depois da distribuição dos processos.", include=FALSE}
aux_plot %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor_mediana)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

<!-- A Figura \@ref(fig:valores-def) mostra os mesmos valores do gráfico anterior, mas utilizando a data de deferimento como referência. Os resultados são similares. Por isso, podemos utilizar qualquer uma das datas como referência. -->

```{r valores-def, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor médio de pagamento de ICMS antes e depois do deferimento dos processos.", include=FALSE}
aux_plot_def <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_decisao_deferimento) / 365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo,
  ) %>% 
  dplyr::group_by(tempo) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(-c(tempo, n, valor), ~./max(., na.rm = TRUE)))

aux_plot_def %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

<!-- A Figura \@ref(fig:taxas-def) mostra as mesmas taxas, mas usando o deferimento como data de referência. Como esperado, os resultados são similares. -->

```{r taxas-def, message=FALSE, fig.height=6, fig.width=9, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois do deferimento dos processos, considerando quatro metodologias para controlar pelo porte da empresa.", include=FALSE}

aux_plot_def %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor, capital, total, faturamento, divida)) %>% 
  dplyr::filter(name != "valor") %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~name, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

<!-- A Figura \@ref(fig:taxa-desfecho) mostra as taxas de pagamento por status do processo. Como esperado, os casos que acabam em falência têm os pagamentos reduzidos à zero com o tempo. Todas as demais apresentam o formato em “U”, embora cada situação numa dinâmica diferente. É interessante notar que as recuperações que se encontram na fase de acompanhamento e já ultrapassaram a marca de 2 anos apresentam um retorno no pagamento dos tributos. Isso pode ser um indicativo de que o período de acompanhamento deveria ser estendido. -->

```{r taxa-desfecho, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos.", eval=FALSE, include=FALSE}


aux_plot_desfecho %>%
  ggplot(aes(tempo, total)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")



```


<!-- Finalmente, podemos modificar a análise para considerar como data de referência a data de homologação do plano, no lugar da data de distribuição do processo. Dessa forma, é possível identificar a dinâmica de pagamentos anterior e posteriormente à negociação. -->

<!-- A Figura \@ref(fig:valor-desfecho-concessao) mostra os valores médios pagos usando como data de referência a data de homologação do plano. Os resultados são interessantes, pois mostram um aparente crescimento nos pagamentos após a concessão, seguidos de uma queda. Isso pode ser um indicativo de modificações na atividade empresarial após o início do plano de recuperação. -->

```{r valor-desfecho-concessao, message=FALSE, layout="l-body-outset", fig.cap="Valores de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos.", include=FALSE}
aux_plot_desfecho_concessao <- aux_valor %>% 
  dplyr::mutate(dt_ref = dplyr::coalesce(data_concessao, data_aprovacao)) %>% 
  dplyr::filter(!is.na(dt_ref)) %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - dt_ref)/365.25,
    tempo = cut(x, seq(-10, 9), labels = seq(-9, 9))
  ) %>%
  dplyr::group_by(tempo, n_processo, desfecho_final) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    valor_processo = dplyr::first(valor_processo),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_processo = valor_total / valor_processo,
    valor_divida = valor_total / divida
  ) %>% 
  dplyr::group_by(tempo, desfecho_final) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::group_by(desfecho_final) %>% 
  dplyr::mutate(dplyr::across(
    c(capital, total, divida), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::filter(dplyr::between(tempo, -5, 5))


aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, valor)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
    scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

<!-- A Figura \@ref(fig:taxa-desfecho-concessao) mostra as taxas de pagamento por status do processo, considerando a data de homologação do plano como data de referência. Nessa visualização, fica ainda mais evidente o retorno da atividade empresarial após o início efetivo do plano de recuperação.  -->

```{r taxa-desfecho-concessao, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos.", include=FALSE}


aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, total)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

<!-- A Figura \@ref(fig:taxa-desfecho-concessao-divida) mostra a mesma informação, mas utilizando a dívida como valor de referência. Por essa métrica, foi possível identificar um decrescimento nos pagamentos após algum tempo passado da homologação do plano. A curva em formato de "U" fica evidente nos casos que estão na fase de acompanhamento por mais de dois anos. -->

```{r taxa-desfecho-concessao-divida, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos, utilizando a dívida como valor de referência.", include=FALSE}
aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, divida)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")
```


<!-- ### Perfis individuais para estudar -->

```{r curvas-individuais-dados, include=FALSE}
aux_individual <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_dist)/365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>%
  dplyr::mutate(valor_divida = valor_total / divida) %>% 
  dplyr::arrange(n_processo, tempo) %>% 
  dplyr::filter(!is.na(divida)) %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(
    dplyr::n() > 5, 
    any(tempo == "0"),
    any(tempo == "-2"),
    any(tempo == "3")
  ) %>% 
  dplyr::ungroup()

n_processos_ind <- length(unique(aux_individual$n_processo))

```

<!-- O critério utilizado para escolher os processos foi: i) tem divida, ii) tem pelo menos 2 anos de informação antes da distribuição e 3 anos depois da distribuição. Existem `r n_processos_ind` processos assim na base. -->

```{r curvas-individuais, fig.height=7, fig.width=8, layout="l-body-outset", include=FALSE}
aux_individual %>%
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = tempo, y = valor_divida, group = 1) +
  ggplot2::geom_line(size = .8, colour = blue_abj) +
  ggplot2::facet_wrap(~n_processo, scales = "free_y", ncol = 3) +
  ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "red") +
  ggplot2::theme_bw(10) +
  ggplot2::theme(
    axis.text.y = ggplot2::element_blank(),
    axis.ticks.y = ggplot2::element_blank()
  )
  
```

<!-- Foram considerados os seguintes processos: -->

```{r eval=FALSE, include=FALSE}
cat(paste0("- ", unique(aux_individual$n_processo)), sep = "\n")
```

<!-- - 00153905020138260100 -->
<!-- - 10006153720178260176 -->
<!-- - 10006608820168260301 -->
<!-- - 10007725320168260076 -->
<!-- - 10008567620178260510 -->
<!-- - 10020407020178260606 -->
<!-- - 10028129620168260564 -->
<!-- - 10039912320178260114 -->
<!-- - 10046286820168260482 -->
<!-- - 10048481420178260100 -->
<!-- - 10060875220178260068 -->
<!-- - 10076574120158260554 -->
<!-- - 10078042720148260223 -->
<!-- - 10099939520158260302 -->
<!-- - 10120146220148260566 -->
<!-- - 10548891920168260100 -->
<!-- - 10653291120158260100 -->
<!-- - 10677689220158260100 -->