---
title: "Recuperação judicial, preservação formal e substancial da empresa"
description: |
  Evidências empíricas sobre a efetividade da recuperação judicial na manutenção da atividade econômica das empresas.
author:
  - name: Marcelo Barbosa Sacramone
    url: https://www.sacramone.com.br/sobre/
  - name: Julio Trecenti
    url: https://www.linkedin.com/in/jtrecenti/
  - name: Igor Pretel
    url: https://www.linkedin.com/in/pretel/
  - name: Marcelo Guedes Nunes
    url: https://www.linkedin.com/in/marcelo-guedes-nunes-849a4536/
  - name: Ivo Waisberg
    url: https://www.linkedin.com/in/ivo-waisberg/
categories:
  - Obervatorio
  - Recuperacoes
date: 12-16-2020
output:
  distill::distill_article:
    self_contained: false
# output:
#   bookdown::word_document2
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE
)
library(magrittr)
library(lubridate)
library(ggplot2)
library(obsFase2)
```

## Avaliação empírica da recuperação de empresas

A recuperação judicial é um instituto que tem por objetivo auxiliar empresas a superar um momento conjuntural de crise econômico-financeira. Seu propósito é evitar que negócios saudáveis e competitivos venham a falir como resultado de problemas circunstanciais ou momentâneos de mercado, preservando a fonte geradora de riquezas, inovação, pagamento de tributos e empregos. O transcurso de 15 anos de vigência da Lei 11.101/2005 (LFRJ) e a ocorrência de crises conjunturais nesse período recomendam a realização de uma avaliação empírica do cumprimento dessas metas. Duas estratégias podem ser utilizadas para realizar essa avaliação.

A primeira é a verificação da quantidade de falências requeridas e decretadas no Brasil antes e após a vigência da LFRJ. Como o objetivo foi evitar a ocorrência de falências, espera-se que a quantidade de quebras observada no Poder Judiciário tenha sofrido uma diminuição depois da vigência da lei. Espera-se, também, que esse novo patamar não tenha sofrido aumentos significativos durante os períodos cíclicos de crise no país. O propósito é verificar (1) se a LFRJ induziu o surgimento de uma "taxa natural" de falências para o Brasil e (2) se essa taxa é ou não afetada em épocas de crise. Caso a LFRJ seja eficaz, a resposta para as duas questões deveria ser positiva: a existência de uma taxa de mortalidade empresarial estável indicaria que a LFRJ foi bem sucedida ao proteger as empresas dos efeitos deletérios das crises econômicas conjunturais.

Tal análise, no entanto, é insuficiente para avaliar o sucesso da LFRJ, tendo em vista que a mera preservação formal de uma empresa ativa (no sentido subjetivo)  não é garantia da preservação de sua atividade econômica. Além da manutenção de um CNPJ e da não ocorrência de uma liquidação dos ativos de forma fragmentada, é necessário verificar se o nível de atividade econômica remanescente das empresas em crise foi mantido após o processamento da recuperação judicial. Por essa razão, na segunda etapa do trabalho procuraremos observar e mensurar o nível de atividade econômica remanescente das empresas após o uso da recuperação judicial. A pergunta que norteou o estudo nesta parte foi: o nível de atividade da empresa antes do início da recuperação judicial sofreu alterações durante a negociação e depois do período de cumprimento do plano? Quanto menor for o nível de atividade remanescente, mais próxima de uma falência a recuperação judicial se coloca, o que pode levantar dúvidas sobre a utilização abusiva da recuperação judicial como uma forma oblíqua de liquidação de ativos. 

Mas como medir o nível de atividade econômica remanescente de uma empresa em recuperação judicial? Uma das maneiras de se acessar essa grandeza é através de uma comparação entre o nível de recolhimento de tributos da devedora antes e depois da recuperação judicial. Para verificar se esse nível foi reduzido, mantido ou incrementado após o processamento da recuperação judicial, utilizamos os registros de pagamento de tributos estaduais como referência do nível de atividade econômica. O resultado esperado pelo legislador é uma curva de pagamento de tributos estaduais em formato de “U”, indicando um patamar normal de recolhimento antes da crise, seguido de uma queda no período da crise e, por fim, de uma retomada  ao patamar normal após a finalização do processo de recuperação judicial. Quanto mais o nível posterior de recolhimento se aproximar do anterior à recuperação, maiores serão os indicativos de que o instituto induziu a uma efetiva recuperação substancial da atividade econômica. Por outro lado, quanto mais o nível posterior se distanciar do anterior, mais próxima estará a recuperação judicial de uma liquidação dos ativos.


## Metodologia

```{r escopo}

col_abj <- viridis::viridis(2, 1, .2, .8)
blue_abj <- col_abj[1]
green_abj <- col_abj[2]


n_obs <- nrow(obsFase2::da_relatorio)
n_obs_trib <- scales::number(
  nrow(obsTrib::da_icms), 
  big.mark = ".", 
  decimal.mark = ","
)
escopo <- format(range(obsFase2::da_relatorio$data_dist), "%d de %B de %Y")
escopo <- paste(escopo, sep = " e ")

da_plano <- obsFase2::da_relatorio %>% 
  dplyr::filter(stringr::str_detect(resultado_final, "Aprov")) %>% 
  dplyr::select(
    n_processo, 
    faturamento_total,
    divida,
    data_dist,
    data_decisao_deferimento,
    data_aprovacao,
    data_concessao,
    resultado_final,
    data_falencia,
    data_referencia,
    data_fim,
    desfecho_final,
    tempo_acompanhamento
  )


```

A pesquisa contou com duas bases de dados principais. A primeira é a base do [observatório das recuperações judiciais](https://abjur.github.com/obsFase2)[^obs], que contém informações de `r n_obs` processos distribuídos entre `r escopo`. 


O estudo foi realizado a partir de três bases de dados. A primeira é a base do observatório das recuperações judiciais, que contém informações de `r n_obs` processos distribuídos entre `r escopo`. Para os fins do estudo, consideramos somente os casos em que o plano de recuperação foi aprovado, envolvendo `r nrow(da_plano)` casos. A segunda base de dados é a de tributos, fornecida pela Procuradoria Geral do Estado de São Paulo (PGE-SP). A base contém `r n_obs_trib` dados de pagamentos de tributos de todas as empresas envolvidas nas recuperações judiciais analisadas no observatório. A terceira base de dados contém o volume mensal de pedidos de recuperação judicial e falências decretadas desde 1995 até 2020 em todo o Brasil.

[^obs]: O Observatório da Insolvência é um trabalho contínuo da Associação Brasileira de Jurimetria - ABJ em parceria com a Pontifícia Universidade Católica de São Paulo - PUCSP, com o objetivo de acompanhar e estudar o comportamento dos processos judiciais de recuperação judicial e falência no Brasil. O observatório extrai e estrutura dados judiciais para viabilizar estudos empíricos sobre a crise empresarial, que servem de subsídio para a tomada de decisões estratégicas e a elaboração de políticas públicas baseadas em evidências.

O pagamento de tributos foi utilizado como uma *proxy* da atividade da empresa. A proxy possui vantagens e desvantagens. A principal vantagem é que o pagamento de tributos estaduais como o ICMS é uma consequência direta da venda de produtos, o que contempla uma parte significativa das empresas consideradas no estudo. Com relação às desvantagens, destacamos duas principais. Primeiro, o tributo de maior interesse, o ICMS, pode não fazer parte das atividades de algumas empresas, como prestadoras de serviço. Além disso, diferentes empresas podem ter estratégias diferentes de pagamento de tributos, de forma que a falta de pagamento em determinado período não significa, necessariamente, que a empresa não teve atividades no mesmo período. No estudo assumimos como suposição de que o efeito de estratégias pontuais de algumas empresas para pagamento de tributos é desprezível.

A análise considerou somente os casos que tiveram o processamento da recuperação judicial deferido e plano de recuperação aprovado. Foram consideradas três etapas principais: antes do deferimento, entre o deferimento e a aprovação do plano, e após a aprovação do plano. Como uma parte dos processos ainda estavam na etapa de cumprimento do plano no momento da realização da pesquisa, parte das análises separaram casos que tiveram o plano aprovado até meados de 2017, de modo a identificar todos os processos que passaram pelos 2 anos obrigatórios da etapa de cumprimento do plano.

Outro aspecto importante a ser controlado é o porte da empresa. Empresas de maior porte pagam mais tributos, o que poderia distorcer as análises. Por isso, foi necessário empregar uma variável de normalização para ajustar o recolhimento ao porte da empresa. Quatro foram as variáveis de normalização consideradas: capital social, faturamento, média de recolhimento de tributos e endividamento. A informação do faturamento da empresa, colhida dos balanços submetidos para processamento de recuperação judicial, foi descartada porque não estava disponível em todos os casos. O capital social, obtido a partir do cruzamento dos CNPJs com a base pública da Receita Federal do Brasil (RFB), foi descartado por ser um dado histórico não relacionado ao porte da empresa no momento da apresentação do pedido de recuperação judicial. A média de tributos recolhida no período foi descartada pela possibilidade dar uma ênfase muito elevada a empresas que recolhem poucos tributos estaduais. Ao final, a variável de normalização escolhida foi o endividamento da empresa na data de apresentação do pedido de recuperação judicial, obtida a partir da lista de credores ou quadro geral de credores homologado. Além de ser contemporânea ao pedido de recuperação, o endividamento está correlacionado com o ativo da empresa e com o seu faturamento bruto anual, conforme demonstrado na segunda fase do Observatório da Insolvência.

Da combinação dessas análises, esperamos sugerir respostas para duas questões, relacionadas ao que chamaremos aqui de preservação formal e preservação substancial de empresas. A LFRJ preservou a existência formal de empresas, reduzindo a quantidade de decretação de falências? Além disso, caso seja confirmada a ocorrência da preservação formal, as empresas que não tiveram sua falência decretada em decorrência da proteção  da LFRJ preservaram a continuidade substancial de suas atividades em um nível próximo ao anterior à crise? A preservação formal consiste na não decretação da quebra e consequente liquidação da empresa. Já a preservação substancial consiste na preservação da atividade em um nível próximo ao existente antes da crise. A distinção é importante porque o objetivo teleológico e sistemático da lei é a preservação da atividade, o que pode e deve ocorrer no procedimento falimentar, com a alienação da empresa ou de unidades produtivas isoladas, respeitando-se a ordem correta de pagamento dos credores. 

## Preservação formal da empresa: resultados da primeira análise

A Figura \@ref(fig:falrec) mostra a série histórica de pedidos e de decretações de falência no Estado de São Paulo de 1995 até dezembro de 2020. A linha pontilhada indica o momento do início da vigência da LFRJ. 

```{r falrec, fig.cap="Volume mensal de falências requeridas e decretadas antes e depois do início da vifência da LFRJ.", fig.width=9, fig.height=7, layout="l-body-outset"}

media_pos_2017 <- falrec::falrec %>% 
  dplyr::filter(tipo == "fal", evento == "req", data >= "2007-01-01") %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

media_dec_pos_2017 <- falrec::falrec %>% 
  dplyr::filter(tipo == "fal", evento == "dec", data >= "2009-01-01") %>% 
  with(mean(n, na.rm = TRUE)) %>% 
  round()

falrec::falrec %>% 
  dplyr::mutate(wrap = dplyr::case_when(
    tipo == "fal" & evento == "req" ~ "1. Falências Requeridas",
    tipo == "fal" & evento == "dec" ~ "2. Falências Decretadas"
  )) %>% 
  dplyr::filter(
    n > 0, 
    tipo == "fal", 
    tamanho == "total",
    data >= "1995-01-01"
  ) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = data, y = n) +
  ggplot2::geom_line(colour = blue_abj, size = .8) +
  ggplot2::facet_wrap(~wrap, scales = "free_y", ncol = 1) +
  ggplot2::geom_vline(
    xintercept = as.Date("2005-01-01") + 120, 
    colour = "red",
    linetype = 2
  ) +
  ggplot2::scale_x_date(date_breaks = "2 year", date_labels = "%Y") +
  ggplot2::theme_bw(12) +
  ggplot2::scale_colour_viridis_d(begin = .2, end = .8) +
  ggplot2::labs(x = "Data", y = "Volume mensal", colour = "Tamanho") +
  ggplot2::theme(legend.position = "bottom")
```


Os dados apontam a existência de um impacto da LFRJ nas duas métricas, que descrevem trajetórias de queda a partir de 2005. A quantidade de pedidos de falência cai abruptamente até atingir o patamar de `r media_pos_2017` pedidos por mês e estabilizar. A queda pode ser atribuída principalmente ao artigo art. 94 da LFRJ, que limitou o valor mínimo de um pedido de falência a quarenta salários mínimos e assim afastou pedidos frívolos de quebra, baseados em montantes irrisórios. A quantidade de decretações de quebra também cai, mas descreve uma trajetória diferente. A queda não ocorre de forma tão acentuada e se estende por 4 anos até atingir o patamar de `r media_dec_pos_2017` falências decretadas por mês e estabilizar. A queda prolongada é uma decorrência direta da redução na quantidade de pedidos de falência protraída no tempo.

A análise dos dados mostra, ainda, que os patamares de pedidos e de decretações de falência não sofreram aumentos significativos nos períodos de crise macroeconômica, que se seguiram à LFRJ. Entre 2005 e 2020, o Brasil passou por duas crises com fortes retrações no PIB em curtos períodos de tempo: 2007-2008 (crise de subprime) e 2014-2015 (crise do impeachment da Dilma). Os impactos da queda no PIB tendem a ser explicitados em ações de insolvência em até 4 meses após a retração. Ao mesmo tempo em que os dados não indicam aumentos significativos na quantidade de falências requeridas ou decretadas nos respectivos períodos, observa-se um aumento significativo na quantidade de recuperações judiciais requeridas nos intervalos de tempo associados às crises.

A análise sugere a existência de uma redução na quantidade de falências requeridas e decretadas após a vigência da LFRJ, com a estabilização em novos patamares naturais mais baixos, bem como indica a ausência de impacto das crises nessas duas quantidades, como esperado pelo legislador. Do ponto de vista formal, a existência das empresas foi preservada pela LFRJ. A questão agora diz respeito à preservação substancial das atividades, ou seja, se as empresas que deixaram de ter a sua falência formalmente decretada foram capazes de preservar suas atividades em níveis próximos aqueles existentes antes da recuperação judicial.

## Resultados da segunda análise

Os gráficos foram elaborados a partir dos passos definidos a seguir. 

Com base nisso foi criada uma variável que mede o tempo entre o pagamento de um tributo e a distribuição do processo: se o pagamento ocorreu antes da distribuição, o tempo é negativo; se ocorreu depois, é positivo. Os tempos foram então agrupados por ano, somando-se os valores totais pagos em cada intervalo. Os valores pagos foram então divididos pela variável de normalização. Finalmente, para cada intervalo, foi calculado o valor médio das taxas normalizadas, colocadas no intervalo `[0,1]`.

```{r base-obs}
empresas_processos <- obsFase2::out_ramo_atuacao %>% 
  dplyr::select(n_processo, cnpj) %>% 
  dplyr::distinct(cnpj, .keep_all = TRUE)
  
aux_valor <- obsTrib::da_icms %>% 
  dplyr::select(-data_falencia) %>% 
  # depara
  dplyr::inner_join(empresas_processos, "cnpj") %>% 
  # coloca processos
  dplyr::inner_join(da_plano, "n_processo") %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::mutate(
    capital = sum(capital[!duplicated(cnpj) & capital > 0]),
    periodo = as.numeric(diff(range(data_movimento))) / 365.25,
    valor_processo = sum(valor_total) / periodo
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(capital = dplyr::case_when(
    capital == 0 ~ NA_real_,
    TRUE ~ capital
  )) %>% 
  tidyr::replace_na(
    list(desfecho_final = "Fase de acompanhamento (até 2 anos)")
  ) %>% 
  dplyr::mutate(desfecho_final = dplyr::case_when(
    desfecho_final == "Ainda em curso" ~ 
      "Fase de acompanhamento (> 2 anos)",
    TRUE ~ desfecho_final
  ))

aux_plot <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_dist)/365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>%
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo,
  ) %>% 
  dplyr::group_by(tempo) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor_mediana = median(valor_total, na.rm = TRUE),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(
    -c(tempo, n, valor, valor_mediana), 
    ~./max(., na.rm = TRUE)
  ))

```

A Figura \@ref(fig:valores) mostra o valor anual médio de recolhimento antes e depois da distribuição dos processos, sem normalização. É possível observar que os pagamentos sofrem uma queda próximos à distribuição, que retornam a partir dos seis anos após a distribuição.

```{r valores, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor médio de pagamento de ICMS antes e depois da distribuição dos processos."}
aux_plot %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```


A Figura \@ref(fig:taxas) mostra as taxas de pagamento de ICMS antes e depois da distribuição dos processos, considerando a dívida para controlar pelo porte da empresa. Os pagamentos sofrem uma abrupta e esperada queda, mas ficam estáveis nos períodos subsequentes após a distribuição. Isso poderia indicar uma eventual mudança de atividade das empresas após o processamento da recuperação judicial.

```{r taxas, message=FALSE, fig.height=4, fig.width=7, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da distribuição dos processos, considerando a dívida para controlar pelo porte da empresa."}

aux_plot %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor, capital, total, faturamento, divida)) %>% 
  dplyr::filter(name == "divida") %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  # facet_wrap(~name, ncol = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

Uma segunda investigação de interesse é verificar os pagamentos de acordo com o status do processo. Os processos foram divididos em falência durante o cumprimento, encerramento da recuperação, fase de cumprimento (até 2 anos) e fase de cumprimento (passados 2 anos).

A Figura \@ref(fig:valor-desfecho) mostra os valores médios de pagamento por status do processo, sem normalização. Nos casos de encerramento sem falências, os pagamentos aumentam ao longo do tempo. Nos casos que acabaram em falência, os pagamentos decrescem ao longo do tempo. Nos casos que se encontram ativos, é possível identificar um decrescimento, seguido de um crescimento nos pagamentos, mas em momentos distintos.

```{r valor-desfecho, message=FALSE, layout="l-body-outset", fig.cap="Taxa de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos, utilizando a dívida."}

aux_plot_desfecho <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_dist)/365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo, desfecho_final) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    valor_processo = dplyr::first(valor_processo),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_processo = valor_total / valor_processo,
    valor_divida = valor_total / divida,
  ) %>% 
  dplyr::group_by(tempo, desfecho_final) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::group_by(desfecho_final) %>% 
  dplyr::mutate(dplyr::across(
    c(capital, total, divida), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::filter(dplyr::between(tempo, -3, 7))


aux_plot_desfecho %>%
  ggplot(aes(tempo, valor)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```


A Figura \@ref(fig:taxa-desfecho-divida) mostra as taxas de pagamento por status do processo, considerando a dívida como variável de normalização. É possível observar que os casos de encerramento sem falência ou fase de acompanhamento curta ficaram tiveram decrescimento nos pagamentos após a distribuição, enquanto que nos casos que estão em fase de acompanhamento há muito tempo os pagamentos já voltaram e até ultrapassaram patamares anteriores.

```{r taxa-desfecho-divida, message=FALSE, layout="l-body-outset", fig.cap="Taxa de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos, utilizando a dívida."}
aux_plot_desfecho %>%
  ggplot(aes(tempo, divida)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

## Considerações finais

O objetivo do presente estudo foi identificar evidências empíricas da recuperação da atividade empresarial, a partir de dados do Observatório da Insolvência e de pagamento de ICMS pelas empresas. A hipótese de pesquisa era que as empresas apresentariam uma dinâmica de pagamento no formato de “U”, deixando de pagar os tributos durante o processamento da recuperação e o retorno dos pagamentos após a aprovação do plano.

Pela metodologia utilizada e dados observados, é possível afirmar que existem evidências de que as empresas de fato apresentam o referido comportamento. Tanto considerando a data de distribuição ou a data de homologação do plano como referência, foi possível identificar que as empresas que se recuperam ou estão em fase de cumprimento retornam o pagamento dos tributos em patamares similares aos observados nos anos anteriores, e que as empresas que acabam falindo deixam de pagar os tributos ao longo dos anos.

Ao considerar a dívida como fator para controlar pelo porte da empresa, os resultados são um pouco diferentes. Pelo observado, existe uma redução da atividade empresarial após a data de referência. Além disso, os resultados são diferentes de acordo com o status do processo. Ou seja, a dinâmica de pagamentos de tributos pode depender da forma em que plano de recuperação é acompanhado após sua homologação.

Finalmente, considerando como referência a data de homologação do plano e a média de pagamentos sem normalização, é possível identificar uma aumento no pagamento de tributos, seguido de um decrescimento.



### Gráficos descartados durante a análise

Os resultados podem ser observados na Tabela \@ref(tab:aux-plot). É possível observar que alguns intervalos de tempo ficaram com poucas observações, o que poderia distorcer os resultados. Por esse motivo, consideramos apenas intervalos com mais de 30 observações.

```{r aux-plot}

aux_plot %>% 
  dplyr::select(-valor_mediana) %>% 
  purrr::set_names(c("Intervalo", 
                     "N", 
                     "Valor",
                     "Taxa (capital)",
                     "Taxa (valor pago)", 
                     "Taxa (faturamento)",
                     "Taxa (dívida)")) %>% 
  knitr::kable(
    caption = "Valores representando a dinâmica de pagamento de tributos, considerando as três estratégias para controlar pelo porte da empresa.", 
    digits = 2
  )
```


A Figura \@ref(fig:valores-mediana) mostra a mesma informação do gráfico anterior, mas utilizando a mediana como base. Com a mediana, observamos uma variabilidade maior nas barras, especialmente nas barras em que temos poucos dados. Por esse motivo, nesse caso a média pode ser mais apropriada.

```{r valores-mediana, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor mediano de pagamento de ICMS antes e depois da distribuição dos processos."}
aux_plot %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor_mediana)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

A Figura \@ref(fig:valores-def) mostra os mesmos valores do gráfico anterior, mas utilizando a data de deferimento como referência. Os resultados são similares. Por isso, podemos utilizar qualquer uma das datas como referência.

```{r valores-def, message=FALSE, fig.height=5, fig.width=8, layout="l-body-outset", fig.cap="Valor médio de pagamento de ICMS antes e depois do deferimento dos processos."}
aux_plot_def <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_decisao_deferimento) / 365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    faturamento = dplyr::first(faturamento_total),
    divida = dplyr::first(divida),
    valor_processo = dplyr::first(valor_processo),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_faturamento = valor_total / faturamento,
    valor_divida = valor_total / divida,
    valor_processo = valor_total / valor_processo,
  ) %>% 
  dplyr::group_by(tempo) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    # media = mean(valor_total),
    # mediana = median(valor_total),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    # mediana_capital = median(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    # mediana_processo = median(valor_processo, na.rm = TRUE),
    faturamento = mean(valor_faturamento, na.rm = TRUE),
    # mediana_faturamento = median(valor_faturamento, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(dplyr::across(-c(tempo, n, valor), ~./max(., na.rm = TRUE)))

aux_plot_def %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor)) %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  theme_minimal(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

A Figura \@ref(fig:taxas-def) mostra as mesmas taxas, mas usando o deferimento como data de referência. Como esperado, os resultados são similares.

```{r taxas-def, message=FALSE, fig.height=6, fig.width=9, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois do deferimento dos processos, considerando quatro metodologias para controlar pelo porte da empresa."}

aux_plot_def %>%
  dplyr::filter(n > 30) %>% 
  tidyr::pivot_longer(c(valor, capital, total, faturamento, divida)) %>% 
  dplyr::filter(name != "valor") %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::mutate(name = stringr::str_to_title(name)) %>% 
  ggplot(aes(tempo, value)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~name, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

A Figura \@ref(fig:taxa-desfecho) mostra as taxas de pagamento por status do processo. Como esperado, os casos que acabam em falência têm os pagamentos reduzidos à zero com o tempo. Todas as demais apresentam o formato em “U”, embora cada situação numa dinâmica diferente. É interessante notar que as recuperações que se encontram na fase de acompanhamento e já ultrapassaram a marca de 2 anos apresentam um retorno no pagamento dos tributos. Isso pode ser um indicativo de que o período de acompanhamento deveria ser estendido.

```{r taxa-desfecho, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da distribuição dos processos, separando pelo status dos processos."}


aux_plot_desfecho %>%
  ggplot(aes(tempo, total)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")



```


Finalmente, podemos modificar a análise para considerar como data de referência a data de homologação do plano, no lugar da data de distribuição do processo. Dessa forma, é possível identificar a dinâmica de pagamentos anterior e posteriormente à negociação.

A Figura \@ref(fig:valor-desfecho-concessao) mostra os valores médios pagos usando como data de referência a data de homologação do plano. Os resultados são interessantes, pois mostram um aparente crescimento nos pagamentos após a concessão, seguidos de uma queda. Isso pode ser um indicativo de modificações na atividade empresarial após o início do plano de recuperação.

```{r valor-desfecho-concessao, message=FALSE, layout="l-body-outset", fig.cap="Valores de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos."}
aux_plot_desfecho_concessao <- aux_valor %>% 
  dplyr::mutate(dt_ref = dplyr::coalesce(data_concessao, data_aprovacao)) %>% 
  dplyr::filter(!is.na(dt_ref)) %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - dt_ref)/365.25,
    tempo = cut(x, seq(-10, 9), labels = seq(-9, 9))
  ) %>%
  dplyr::group_by(tempo, n_processo, desfecho_final) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    capital = dplyr::first(capital),
    valor_processo = dplyr::first(valor_processo),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  dplyr::mutate(
    valor_capital = valor_total / capital,
    valor_processo = valor_total / valor_processo,
    valor_divida = valor_total / divida
  ) %>% 
  dplyr::group_by(tempo, desfecho_final) %>% 
  dplyr::summarise(
    n = dplyr::n(),
    valor = mean(valor_total, na.rm = TRUE),
    capital = mean(valor_capital, na.rm = TRUE),
    total = mean(valor_processo, na.rm = TRUE),
    divida = mean(valor_divida, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  dplyr::group_by(desfecho_final) %>% 
  dplyr::mutate(dplyr::across(
    c(capital, total, divida), 
    ~./max(., na.rm = TRUE)
  )) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  dplyr::filter(dplyr::between(tempo, -5, 5))


aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, valor)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
    scale_y_continuous(labels = scales::dollar_format(
    prefix = "R$", big.mark = ".", decimal.mark = ","
  )) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Recolhimento médio")

```

A Figura \@ref(fig:taxa-desfecho-concessao) mostra as taxas de pagamento por status do processo, considerando a data de homologação do plano como data de referência. Nessa visualização, fica ainda mais evidente o retorno da atividade empresarial após o início efetivo do plano de recuperação. 

```{r taxa-desfecho-concessao, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos."}


aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, total)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")

```

A Figura \@ref(fig:taxa-desfecho-concessao-divida) mostra a mesma informação, mas utilizando a dívida como valor de referência. Por essa métrica, foi possível identificar um decrescimento nos pagamentos após algum tempo passado da homologação do plano. A curva em formato de "U" fica evidente nos casos que estão na fase de acompanhamento por mais de dois anos.

```{r taxa-desfecho-concessao-divida, message=FALSE, layout="l-body-outset", fig.cap="Taxas de pagamento de ICMS antes e depois da homologação do plano de recuperação, separando pelo status dos processos, utilizando a dívida como valor de referência."}
aux_plot_desfecho_concessao %>%
  ggplot(aes(tempo, divida)) +
  geom_col(fill = blue_abj) +
  geom_smooth(se = FALSE, colour = green_abj) +
  scale_x_continuous(breaks = seq(-10, 10)) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2) +
  facet_wrap(~desfecho_final, ncol = 2) +
  theme_bw(12) +
  labs(x = "Intervalo de tempo", y = "Taxa")
```


### Perfis individuais para estudar

```{r curvas-individuais-dados}
aux_individual <- aux_valor %>% 
  dplyr::mutate(
    x = as.numeric(data_movimento - data_dist)/365.25,
    tempo = cut(x, seq(-7, 10), labels = seq(-6, 10))
  ) %>% 
  dplyr::group_by(tempo, n_processo) %>% 
  dplyr::summarise(
    valor_total = sum(valor_total),
    divida = dplyr::first(divida),
    .groups = "drop"
  ) %>% 
  dplyr::filter(valor_total > 0) %>%
  dplyr::mutate(valor_divida = valor_total / divida) %>% 
  dplyr::arrange(n_processo, tempo) %>% 
  dplyr::filter(!is.na(divida)) %>% 
  dplyr::group_by(n_processo) %>% 
  dplyr::filter(
    dplyr::n() > 5, 
    any(tempo == "0"),
    any(tempo == "-2"),
    any(tempo == "3")
  ) %>% 
  dplyr::ungroup()

n_processos_ind <- length(unique(aux_individual$n_processo))

```

O critério utilizado para escolher os processos foi: i) tem divida, ii) tem pelo menos 2 anos de informação antes da distribuição e 3 anos depois da distribuição. Existem `r n_processos_ind` processos assim na base.

```{r curvas-individuais, fig.height=7, fig.width=8, layout="l-body-outset"}
aux_individual %>%
  dplyr::mutate(tempo = as.numeric(as.character(tempo))) %>% 
  ggplot2::ggplot() +
  ggplot2::aes(x = tempo, y = valor_divida, group = 1) +
  ggplot2::geom_line(size = .8, colour = blue_abj) +
  ggplot2::facet_wrap(~n_processo, scales = "free_y", ncol = 3) +
  ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "red") +
  ggplot2::theme_bw(10) +
  ggplot2::theme(
    axis.text.y = ggplot2::element_blank(),
    axis.ticks.y = ggplot2::element_blank()
  )
  
```

Foram considerados os seguintes processos:

```{r eval=FALSE}
cat(paste0("- ", unique(aux_individual$n_processo)), sep = "\n")
```

- 00153905020138260100
- 10006153720178260176
- 10006608820168260301
- 10007725320168260076
- 10008567620178260510
- 10020407020178260606
- 10028129620168260564
- 10039912320178260114
- 10046286820168260482
- 10048481420178260100
- 10060875220178260068
- 10076574120158260554
- 10078042720148260223
- 10099939520158260302
- 10120146220148260566
- 10548891920168260100
- 10653291120158260100
- 10677689220158260100